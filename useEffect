useEffect(() => {
  const handleOutsideClick = (ev: MouseEvent) => {
    const target = ev.target as HTMLElement | null;
    if (!target) return;

    // 1️⃣ Inside InlineAIPrompt? → DO NOT CLOSE
    if (
      target.closest(".k-inline-ai") ||
      target.closest(".k-inline-ai-prompt") ||
      target.closest(".k-popup")
    ) {
      return;
    }

    // 2️⃣ Inside ANY Kendo Editor area? → DO NOT CLOSE
    if (
      target.closest(".k-editor") ||              // whole editor wrapper
      target.closest(".k-editor-content") ||      // editable area
      target.closest(".ProseMirror") ||           // ProseMirror root
      target.closest(".k-editor-toolbar")         // toolbar
    ) {
      return;
    }

    // 3️⃣ Otherwise → Click outside → close prompt
    setShowPrompt(false);
    setSelectedText("");
    setOutputs([]);
    setAnchorEl(undefined);
  };

  document.addEventListener("mousedown", handleOutsideClick, true);
  return () => document.removeEventListener("mousedown", handleOutsideClick, true);
}, []);
