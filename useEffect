useEffect(() => {
  if (!promptRoot) return;

  const buttonSelector =
    'button[title="Commands Button"], button[aria-label="Commands Button"], .k-button.k-icon-button';

  const handler = (ev: PointerEvent | MouseEvent) => {
    const target = ev.target as HTMLElement | null;
    if (!target) return;

    const btn = target.closest?.(buttonSelector) as HTMLElement | null;
    if (!btn) return;

    if (
      !promptRoot.contains(btn) &&
      !btn.closest('.k-prompt-content') &&
      !btn.closest('.k-inlineai')
    ) {
      return;
    }

    // Save scroll position
    const sx = window.scrollX || window.pageXOffset || 0;
    const sy = window.scrollY || window.pageYOffset || 0;

    // ⚠️ DO NOT preventDefault – this breaks focus
    // ⚠️ DO NOT stopPropagation – Kendo needs it

    // Only restore scroll after Kendo does its thing
    requestAnimationFrame(() => {
      window.scrollTo(sx, sy);
    });

    setTimeout(() => {
      window.scrollTo(sx, sy);
    }, 50);
  };

  document.addEventListener('pointerdown', handler, true);

  return () => {
    document.removeEventListener('pointerdown', handler, true);
  };
}, [promptRoot]);
