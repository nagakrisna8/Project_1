useEffect(() => {
  const repositionPopup = () => {
    const popup = document.querySelector('.k-animation-container .k-popup') as HTMLElement | null;
    const anchor = inlinePromptRef.current;

    if (!popup || !anchor) return;

    const rect = anchor.getBoundingClientRect();

    popup.style.position = 'fixed';
    popup.style.top = `${rect.bottom + 6}px`;
    popup.style.left = `${rect.left}px`;
    popup.style.transform = 'none';
    popup.style.zIndex = '10000';
  };

  document.addEventListener('click', repositionPopup, true);
  window.addEventListener('scroll', repositionPopup, true);
  window.addEventListener('resize', repositionPopup);

  return () => {
    document.removeEventListener('click', repositionPopup, true);
    window.removeEventListener('scroll', repositionPopup, true);
    window.removeEventListener('resize', repositionPopup);
  };
}, []);

useEffect(() => {
  const stopFocusJump = (e: MouseEvent) => {
    const target = e.target as HTMLElement;

    if (
      target.closest('.k-inlineai') ||
      target.closest('.k-popup') ||
      target.closest('.k-animation-container')
    ) {
      e.preventDefault();
      e.stopPropagation();
    }
  };

  document.addEventListener('mousedown', stopFocusJump, true);
  return () => document.removeEventListener('mousedown', stopFocusJump, true);
}, []);
